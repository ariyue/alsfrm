package com.als.ums.module.ums.biz.impl;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.als.frm.bas.dao.BasDAOFacade;
import com.als.frm.comm.FrmConstant;
import com.als.frm.comm.util.Md5Util;
import com.als.frm.ex.BizException;
import com.als.mod.domain.UmsUser;
import com.als.ums.module.ums.biz.UmsUserBIZ;

@Service("umUserBIZImpl")
public class UmUserBIZImpl implements UmsUserBIZ{

	@Autowired
	private BasDAOFacade<UmsUser> basDAOFacade;
	
	@Override
	public UmsUser addEntity(UmsUser entity) {

		UmsUser qryEntity = new UmsUser();
		String userName = entity.getUserName();
		String entitySid = entity.getEntitySid();
		qryEntity.setUserName(userName);
		qryEntity.setEntitySid(entitySid);
		
		List<UmsUser> list = basDAOFacade.select(qryEntity);
		if (list != null && list.size() > 0){
			throw new BizException("warning.ums.01006", new Object[]{userName});
		}
		//初始化
		entity.setId(userName + "@" + entitySid);
		entity.setPassword(Md5Util.getMD5Str("Aa123456"));
		entity.setUserLanguage("01");
		return basDAOFacade.insert(entity);
	}

	@Override
	public UmsUser modifyEntity(UmsUser entity) {
		
		String oldUserName = entity.getId().split("@")[0];
		String userName = entity.getUserName().trim();
		String entitySid = entity.getEntitySid();
		if (!oldUserName.equals(userName)){//userName有变化
			UmsUser qryEntity = new UmsUser();
			
			
			qryEntity.setUserName(userName);
			qryEntity.setEntitySid(entitySid);
			
			List<UmsUser> list = basDAOFacade.select(qryEntity);
			if (list != null && list.size() > 0){
				throw new BizException("warning.ums.01006", new Object[]{userName});
			}
		}
		entity.setId(userName + "@" + entitySid);
		return basDAOFacade.update(entity);
	}

	@Override
	public UmsUser removeEntity(UmsUser entity) {
		
		return basDAOFacade.delete(entity);
	}

}
